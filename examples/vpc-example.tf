# Example: Using VPC Module with For Each Pattern\n# This example shows how to create a complete VPC setup using the configuration object approach\n\nmodule \"network\" {\n  source = \"../modules/vpc\"\n\n  # VPCs Configuration\n  vpcs = {\n    \"main-vpc\" = {\n      cidr_block           = \"10.0.0.0/16\"\n      enable_dns_hostnames = true\n      enable_dns_support   = true\n      tags = {\n        Environment = \"dev\"\n        Purpose     = \"main-application\"\n      }\n    }\n  }\n\n  # Internet Gateways Configuration\n  internet_gateways = {\n    \"main-igw\" = {\n      vpc_key = \"main-vpc\"\n      tags = {\n        Environment = \"dev\"\n      }\n    }\n  }\n\n  # Subnets Configuration\n  subnets = {\n    \"public-subnet-1a\" = {\n      vpc_key                 = \"main-vpc\"\n      cidr_block              = \"10.0.1.0/24\"\n      availability_zone       = \"us-west-2a\"\n      map_public_ip_on_launch = true\n      tier                    = \"public\"\n      tags = {\n        Environment = \"dev\"\n        Tier        = \"public\"\n      }\n    }\n    \"public-subnet-1b\" = {\n      vpc_key                 = \"main-vpc\"\n      cidr_block              = \"10.0.2.0/24\"\n      availability_zone       = \"us-west-2b\"\n      map_public_ip_on_launch = true\n      tier                    = \"public\"\n      tags = {\n        Environment = \"dev\"\n        Tier        = \"public\"\n      }\n    }\n    \"private-subnet-1a\" = {\n      vpc_key           = \"main-vpc\"\n      cidr_block        = \"10.0.10.0/24\"\n      availability_zone = \"us-west-2a\"\n      tier              = \"private\"\n      tags = {\n        Environment = \"dev\"\n        Tier        = \"private\"\n      }\n    }\n    \"private-subnet-1b\" = {\n      vpc_key           = \"main-vpc\"\n      cidr_block        = \"10.0.20.0/24\"\n      availability_zone = \"us-west-2b\"\n      tier              = \"private\"\n      tags = {\n        Environment = \"dev\"\n        Tier        = \"private\"\n      }\n    }\n    \"database-subnet-1a\" = {\n      vpc_key           = \"main-vpc\"\n      cidr_block        = \"10.0.100.0/24\"\n      availability_zone = \"us-west-2a\"\n      tier              = \"database\"\n      tags = {\n        Environment = \"dev\"\n        Tier        = \"database\"\n      }\n    }\n    \"database-subnet-1b\" = {\n      vpc_key           = \"main-vpc\"\n      cidr_block        = \"10.0.200.0/24\"\n      availability_zone = \"us-west-2b\"\n      tier              = \"database\"\n      tags = {\n        Environment = \"dev\"\n        Tier        = \"database\"\n      }\n    }\n  }\n\n  # Elastic IPs for NAT Gateways\n  elastic_ips = {\n    \"nat-eip-1a\" = {\n      tags = {\n        Environment = \"dev\"\n        AZ          = \"us-west-2a\"\n      }\n    }\n    \"nat-eip-1b\" = {\n      tags = {\n        Environment = \"dev\"\n        AZ          = \"us-west-2b\"\n      }\n    }\n  }\n\n  # NAT Gateways\n  nat_gateways = {\n    \"nat-gw-1a\" = {\n      subnet_key = \"public-subnet-1a\"\n      eip_key    = \"nat-eip-1a\"\n      tags = {\n        Environment = \"dev\"\n        AZ          = \"us-west-2a\"\n      }\n    }\n    \"nat-gw-1b\" = {\n      subnet_key = \"public-subnet-1b\"\n      eip_key    = \"nat-eip-1b\"\n      tags = {\n        Environment = \"dev\"\n        AZ          = \"us-west-2b\"\n      }\n    }\n  }\n\n  # Route Tables\n  route_tables = {\n    \"public-rt\" = {\n      vpc_key = \"main-vpc\"\n      routes = [\n        {\n          cidr_block   = \"0.0.0.0/0\"\n          gateway_id   = \"main-igw\"\n          gateway_type = \"igw\"\n        }\n      ]\n      tags = {\n        Environment = \"dev\"\n        Type        = \"public\"\n      }\n    }\n    \"private-rt-1a\" = {\n      vpc_key = \"main-vpc\"\n      routes = [\n        {\n          cidr_block     = \"0.0.0.0/0\"\n          nat_gateway_id = \"nat-gw-1a\"\n        }\n      ]\n      tags = {\n        Environment = \"dev\"\n        Type        = \"private\"\n        AZ          = \"us-west-2a\"\n      }\n    }\n    \"private-rt-1b\" = {\n      vpc_key = \"main-vpc\"\n      routes = [\n        {\n          cidr_block     = \"0.0.0.0/0\"\n          nat_gateway_id = \"nat-gw-1b\"\n        }\n      ]\n      tags = {\n        Environment = \"dev\"\n        Type        = \"private\"\n        AZ          = \"us-west-2b\"\n      }\n    }\n    \"database-rt\" = {\n      vpc_key = \"main-vpc\"\n      routes  = [] # No internet access for database subnets\n      tags = {\n        Environment = \"dev\"\n        Type        = \"database\"\n      }\n    }\n  }\n\n  # Route Table Associations\n  route_table_associations = {\n    \"public-subnet-1a-assoc\" = {\n      subnet_key      = \"public-subnet-1a\"\n      route_table_key = \"public-rt\"\n    }\n    \"public-subnet-1b-assoc\" = {\n      subnet_key      = \"public-subnet-1b\"\n      route_table_key = \"public-rt\"\n    }\n    \"private-subnet-1a-assoc\" = {\n      subnet_key      = \"private-subnet-1a\"\n      route_table_key = \"private-rt-1a\"\n    }\n    \"private-subnet-1b-assoc\" = {\n      subnet_key      = \"private-subnet-1b\"\n      route_table_key = \"private-rt-1b\"\n    }\n    \"database-subnet-1a-assoc\" = {\n      subnet_key      = \"database-subnet-1a\"\n      route_table_key = \"database-rt\"\n    }\n    \"database-subnet-1b-assoc\" = {\n      subnet_key      = \"database-subnet-1b\"\n      route_table_key = \"database-rt\"\n    }\n  }\n\n  # VPC Endpoints\n  vpc_endpoints = {\n    \"s3-endpoint\" = {\n      vpc_key           = \"main-vpc\"\n      service_name      = \"com.amazonaws.us-west-2.s3\"\n      vpc_endpoint_type = \"Gateway\"\n      route_table_keys  = [\"private-rt-1a\", \"private-rt-1b\", \"database-rt\"]\n      tags = {\n        Environment = \"dev\"\n        Service     = \"s3\"\n      }\n    }\n    \"dynamodb-endpoint\" = {\n      vpc_key           = \"main-vpc\"\n      service_name      = \"com.amazonaws.us-west-2.dynamodb\"\n      vpc_endpoint_type = \"Gateway\"\n      route_table_keys  = [\"private-rt-1a\", \"private-rt-1b\"]\n      tags = {\n        Environment = \"dev\"\n        Service     = \"dynamodb\"\n      }\n    }\n  }\n\n  # Common tags applied to all resources\n  common_tags = {\n    Project     = \"terraform-multi-account-organization\"\n    ManagedBy   = \"terraform\"\n    Owner       = \"infrastructure-team\"\n    Environment = \"dev\"\n  }\n}\n\n# Outputs\noutput \"vpc_info\" {\n  description = \"VPC information\"\n  value       = module.network.vpcs\n}\n\noutput \"subnet_ids\" {\n  description = \"All subnet IDs\"\n  value       = module.network.subnet_ids\n}\n\noutput \"public_subnet_ids\" {\n  description = \"Public subnet IDs\"\n  value       = module.network.public_subnet_ids\n}\n\noutput \"private_subnet_ids\" {\n  description = \"Private subnet IDs\"\n  value       = module.network.private_subnet_ids\n}\n\noutput \"database_subnet_ids\" {\n  description = \"Database subnet IDs\"\n  value       = module.network.database_subnet_ids\n}